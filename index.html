<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>グラビア印刷ラーニング v2</title>
  <link rel="stylesheet" href="./styles.css?v=20250808" onload="document.documentElement.dataset.css='ok'">
  <meta name="color-scheme" content="light dark">
  <style>
    :root{--bg:#0f172a;--card:#111827;--ink:#e5e7eb;--muted:#9ca3af;--pri:#4f46e5;--ok:#16a34a;--ng:#ef4444;--chip:#334155}
    @media (prefers-color-scheme: light){
      :root{--bg:#f6f7fb;--card:#ffffff;--ink:#0f172a;--muted:#64748b;--chip:#e2e8f0}
    }
    html,body{height:100%} body{margin:0;background:linear-gradient(135deg,var(--bg),#030712);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    .safe{padding:calc(env(safe-area-inset-top,0) + 8px) 12px calc(env(safe-area-inset-bottom,0) + 72px)}
    .topbar{position:sticky;top:0;z-index:10;backdrop-filter:saturate(1.2) blur(6px);background:color-mix(in srgb, var(--card) 80%, transparent);padding:8px 12px;border-bottom:1px solid #1f2937;display:flex;gap:10px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:8px;align-items:center}
    .brand h1{font-size:18px;margin:0}
    .panel{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:12px;margin:10px 0}
    .nav{position:fixed;left:0;right:0;bottom:0;height:64px;background:var(--card);border-top:1px solid #1f2937;display:grid;grid-template-columns:repeat(4,1fr);z-index:20}
    .nav button{background:none;border:none;color:var(--ink);font-size:13px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px}
    .nav button.active{color:#fff}
    .nav .icon{font-size:18px;line-height:18px}
    .btn{background:var(--pri);color:#fff;border:none;border-radius:12px;padding:14px 16px;font-size:16px}
    .btn.secondary{background:#0b1220;border:1px solid #374151;color:var(--ink)}
    .choices{display:grid;grid-template-columns:1fr;gap:10px}
    .choice{background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:12px;padding:14px;text-align:left;font-size:16px}
    .choice.correct{border-color:var(--ok);box-shadow:0 0 0 2px color-mix(in srgb, var(--ok) 40%, transparent)}
    .choice.wrong{border-color:var(--ng);box-shadow:0 0 0 2px color-mix(in srgb, var(--ng) 40%, transparent)}
    .qcard{border:1px solid #27324a;border-radius:14px;overflow:hidden}
    .qhead{padding:14px 14px 6px;font-weight:700}
    .qmeta{padding:0 14px 10px;color:var(--muted);font-size:12px}
    .tag{display:inline-block;background:var(--chip);padding:2px 8px;border-radius:999px;margin-right:6px;font-size:12px}
    .gl-search{display:flex;gap:8px}
    .input{background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:10px;padding:12px;width:100%;font-size:16px}
    .term{padding:12px;border:1px solid #334155;border-radius:12px;background:#0b1220}
    .detail{margin-top:10px;padding:12px;border:1px dashed #334155;border-radius:12px;background:#0b1220}
    .panel[hidden]{display:none}
    @media (min-width:960px){ .safe{padding:16px 16px 88px;max-width:900px;margin:0 auto} .nav{left:50%;right:unset;width:900px;transform:translateX(-50%);border-radius:12px 12px 0 0} }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand"><span>🎨</span><h1>グラビア印刷ラーニング v2</h1></div>
    <div id="stats" class="tag">ロード中…</div>
  </div>
  <main class="safe">
    <section id="tab-train" class="panel">
      <div style="display:grid;gap:12px">
        <div style="display:grid;gap:6px">
          <label class="tag">出題モード</label>
          <select id="mode" class="input">
            <option value="random">ランダム</option>
            <option value="category">カテゴリ指定</option>
            <option value="weak">苦手分野優先</option>
            <option value="wrong">間違えた問題のみ</option>
          </select>
        </div>
        <div id="catWrap" style="display:grid;gap:6px">
          <label class="tag">カテゴリ（複数選択可）</label>
          <select id="category" multiple size="6" class="input"></select>
        </div>
        <div style="display:grid;gap:10px;grid-template-columns:repeat(3,minmax(0,1fr))">
          <button class="btn secondary btn-qty" data-n="10">10問</button>
          <button class="btn secondary btn-qty" data-n="30">30問</button>
          <button class="btn secondary btn-qty" data-n="50">50問</button>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="count" type="number" min="1" max="200" value="10" class="input" style="max-width:120px"/>
          <button id="start" class="btn" style="flex:1">▶ スタート</button>
        </div>
      </div>
      <div id="game" style="margin-top:10px"></div>
    </section>

    <section id="tab-glossary" class="panel" hidden>
      <div class="gl-search">
        <input id="gSearch" type="search" class="input" placeholder="用語を検索…" />
        <select id="gCat" class="input" style="max-width:160px">
          <option value="all">すべて</option>
        </select>
      </div>
      <div id="gCount" class="tag" style="margin-top:8px">0 語</div>
      <ul id="gList" style="list-style:none;padding:0;margin:10px 0;display:grid;gap:10px"></ul>
      <div id="gDetail" class="detail" hidden></div>
    </section>

    <section id="tab-diagram" class="panel" hidden>
      <h3 style="margin:6px 0 10px">🗺️ 図式モード（入稿→色校→製版→実機刷り）</h3>
      <div class="diagram-wrap" style="border:1px solid #334155;border-radius:12px;overflow:hidden">
        <svg viewBox="0 0 900 260" style="width:100%;height:auto;background:#0b1220">
          <defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#22c55e"></path></marker></defs>
          <g class="node" data-term="デザイン入稿" transform="translate(40,40)">
            <rect rx="12" ry="12" width="180" height="60" fill="#0b1220" stroke="#334155" stroke-width="2"></rect>
            <text x="90" y="38" fill="#e5e7eb" text-anchor="middle" font-size="14" font-weight="700">デザイン入稿</text>
            <text x="90" y="54" fill="#9ca3af" text-anchor="middle" font-size="12">データ/プロファイル</text>
          </g>
          <g class="node" data-term="色校正" transform="translate(260,40)">
            <rect rx="12" ry="12" width="180" height="60" fill="#0b1220" stroke="#334155" stroke-width="2"></rect>
            <text x="90" y="38" fill="#e5e7eb" text-anchor="middle" font-size="14" font-weight="700">色校正</text>
            <text x="90" y="54" fill="#9ca3af" text-anchor="middle" font-size="12">基準/ΔE/D50</text>
          </g>
          <g class="node" data-term="製版/版" transform="translate(480,40)">
            <rect rx="12" ry="12" width="180" height="60" fill="#0b1220" stroke="#334155" stroke-width="2"></rect>
            <text x="90" y="38" fill="#e5e7eb" text-anchor="middle" font-size="14" font-weight="700">製版/版</text>
            <text x="90" y="54" fill="#9ca3af" text-anchor="middle" font-size="12">セル/線数</text>
          </g>
          <g class="node" data-term="実機刷り" transform="translate(700,40)">
            <rect rx="12" ry="12" width="180" height="60" fill="#0b1220" stroke="#334155" stroke-width="2"></rect>
            <text x="90" y="38" fill="#e5e7eb" text-anchor="middle" font-size="14" font-weight="700">実機刷り</text>
            <text x="90" y="54" fill="#9ca3af" text-anchor="middle" font-size="12">条件最適/QA</text>
          </g>
          <g class="node" data-term="白引き" transform="translate(150,150)">
            <rect rx="10" ry="10" width="140" height="46" fill="#0b1220" stroke="#334155" stroke-width="2"></rect>
            <text x="70" y="30" fill="#e5e7eb" text-anchor="middle" font-size="14" font-weight="700">白引き</text>
          </g>
          <g class="node" data-term="見当/レジ" transform="translate(360,150)">
            <rect rx="10" ry="10" width="160" height="46" fill="#0b1220" stroke="#334155" stroke-width="2"></rect>
            <text x="80" y="30" fill="#e5e7eb" text-anchor="middle" font-size="14" font-weight="700">見当/レジ</text>
          </g>
          <g class="node" data-term="残留溶剤" transform="translate(560,150)">
            <rect rx="10" ry="10" width="160" height="46" fill="#0b1220" stroke="#334155" stroke-width="2"></rect>
            <text x="80" y="30" fill="#e5e7eb" text-anchor="middle" font-size="14" font-weight="700">残留溶剤</text>
          </g>
          <line x1="220" y1="70" x2="260" y2="70" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow)"></line>
          <line x1="440" y1="70" x2="480" y2="70" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow)"></line>
          <line x1="660" y1="70" x2="700" y2="70" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow)"></line>
          <line x1="210" y1="170" x2="360" y2="170" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow)"></line>
          <line x1="520" y1="170" x2="560" y2="170" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow)"></line>
        </svg>
        <div class="tag" style="display:inline-block;margin:8px">ボックスをタップで用語へ</div>
      </div>
    </section>

    <section id="tab-handbook" class="panel" hidden>
      <h3 style="margin:6px 0 10px">📖 参考書モード</h3>
      <div style="display:grid;gap:8px">
        <select id="hbChapter" class="input"></select>
        <select id="hbSection" class="input"></select>
      </div>
      <article id="hbContent" style="margin-top:10px"></article>
    </section>
  </main>

  <nav class="nav">
    <button data-tab="train" class="active"><span class="icon">🧪</span>トレ</button>
    <button data-tab="glossary"><span class="icon">📚</span>用語</button>
    <button data-tab="diagram"><span class="icon">🗺️</span>図式</button>
    <button data-tab="handbook"><span class="icon">📖</span>参考</button>
  </nav>

  <script src="./app.js?v=20250808"></script>
</body>
</html>
